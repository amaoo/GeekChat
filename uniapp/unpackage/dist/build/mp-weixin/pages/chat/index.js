(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/chat/index"],{"01af":function(n,e,t){"use strict";var o=t("7553"),i=t.n(o);i.a},"3c9b":function(n,e,t){"use strict";t.r(e);var o=t("452b"),i=t.n(o);for(var r in o)["default"].indexOf(r)<0&&function(n){t.d(e,n,(function(){return o[n]}))}(r);e["default"]=i.a},"452b":function(n,e,t){"use strict";(function(n,o){var i=t("4ea4");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=i(t("2eee")),c=i(t("448a")),a=i(t("9523")),u=i(t("c973")),s=i(t("1781")),d=t("0c66");function l(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),t.push.apply(t,o)}return t}function f(n){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?l(Object(t),!0).forEach((function(e){(0,a.default)(n,e,t[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(t,e))}))}return n}var p=null,h={components:{wxLogin:function(){Promise.all([t.e("common/vendor"),t.e("components/wxLogin")]).then(function(){return resolve(t("365d"))}.bind(null,t)).catch(t.oe)},models:function(){t.e("components/model").then(function(){return resolve(t("0016"))}.bind(null,t)).catch(t.oe)}},data:function(){return{isdisable:!1,isLogin:!1,loginShow:!1,talkList:[],content:"",show:!1,isday:0,isnum:5,invite:10,freePerDay:0,advertisement:10,openid:"",obj:{},id:"",socketOpen:!1,text:""}},onShow:function(){n.getStorageSync("token")&&(this.isLogin=!0)},onLoad:function(e){var t=this;return(0,u.default)(r.default.mark((function i(){var c,a;return r.default.wrap((function(i){while(1)switch(i.prev=i.next){case 0:c=e.id,a=t,a.connectSocket(),n.onSocketClose((function(n){console.log("WebSocket 已关闭！"),a.connectSocket()})),n.onSocketOpen((function(n){a.socketOpen=!0,console.log("WebSocket连接已打开！")})),a.id=c,o.createRewardedVideoAd&&(p=o.createRewardedVideoAd({adUnitId:"adunit-593140983fbc3c32"}),p.onLoad((function(){})),p.onError((function(e){n.showToast({title:"暂未开放，请邀请好友",icon:"none",duration:2e3})})),p.onClose((function(e){e.isEnded?a.handleAdd(a.openid,a.advertisement):n.showToast({title:"请不要中途退出!",icon:"none",duration:2e3})})));case 7:case"end":return i.stop()}}),i)})))()},onShareAppMessage:function(n){return{title:"抢先体验GPT-4",path:"/pages/chat/index"}},onShareTimeline:function(){return{title:"抢先体验GPT-4",path:"/pages/chat/index"}},mounted:function(){var n=this;this.$nextTick((function(){n.getHistoryMsg()}))},methods:{handleAd:function(){p&&p.show().catch((function(){p.load().then((function(){return p.show()})).catch((function(n){console.log("激励视频 广告显示失败")}))}))},handleAdd:function(e,t){var o=this;return(0,u.default)(r.default.mark((function i(){var c;return r.default.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return c=o,i.next=3,AddCount({openid:e,count:t});case 3:i.sent,c.isnum=c.isnum+t,n.setStorageSync("config",f(f({},c.obj),{},{num:c.isnum})),n.showToast({title:"恭喜成功获取使用额度",icon:"none",duration:2e3});case 7:case"end":return i.stop()}}),i)})))()},handlefig:function(e){var t=this;return(0,u.default)(r.default.mark((function o(){var i,c,a,u,s,d,l;return r.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return o.next=2,handleConfig(e);case 2:if(i=o.sent,c=i.day,a=i.freePerDay,u=i.invite,s=i.num,d=i.openid,l=i.advertisement,t.isday=c,t.isnum=s,t.invite=u,t.freePerDay=a,t.advertisement=l,t.openid=d,n.hideLoading(),t.obj=i,t.id){o.next=14;break}return o.abrupt("return");case 14:return o.next=16,t.handleAdd(t.id,u);case 16:case"end":return o.stop()}}),o)})))()},close:function(){this.show=!1},handleopen:function(){},handleCopy:function(e){n.setClipboardData({data:e,success:function(){}})},getHistoryMsg:function(){var n=this,e=function(){var e=(0,u.default)(r.default.mark((function e(){var t;return r.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t=[{id:"1",content:"#### GeekChat为您服务：\n- 知乎百度答题、做作业\n- 写代码、写文案、写论文\n- 文案润色、翻译、写诗作词\n- 扮演面试官,扮演书籍电影角色\n- 例：写一篇工作日报我是行政\n- 例：把下文翻译成英文\n\n#### 输出字数不够时，请说继续",type:0,pic:"/static/logo.png"}],"#msg-".concat(t[t.length-1].id),n.talkList=[].concat(t,(0,c.default)(n.talkList));case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e()},send:function(){var e=this;return(0,u.default)(r.default.mark((function t(){var o,i;return r.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(o=e,o.content){t.next=4;break}return n.showToast({title:"请输入有效的内容",icon:"none"}),t.abrupt("return");case 4:o.token=n.getStorageSync("token"),o.socketOpen||o.connectSocket(),o.talkList.push({id:(new Date).getTime(),content:o.content,type:1,pic:"/static/avatar.png"}),n.sendSocketMessage({data:JSON.stringify({content:o.content,event:"chat",token:o.token})}),0,i=e.talkList.length,o.isdisable=!0,n.onSocketMessage((function(e){var t=JSON.parse(e.data);if("chat"==t.event){o.text+=t.content;var r={id:(new Date).getTime(),content:o.text,type:0,pic:"/static/logo.png"};return o.talkList[i]=r,void o.$nextTick((function(){n.pageScrollTo({scrollTop:2e6,duration:0})}))}if("close"==t.event)return o.text="",void(o.isdisable=!1)})),n.hideLoading(),o.$nextTick((function(){o.content="",n.pageScrollTo({scrollTop:999999,duration:0})}));case 14:case"end":return t.stop()}}),t)})))()},login:function(){var n=this;return(0,u.default)(r.default.mark((function e(){return r.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:n.loginShow=!0;case 1:case"end":return e.stop()}}),e)})))()},getUserInfo:function(){var e=this;return(0,u.default)(r.default.mark((function t(){var o;return r.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:o=e,n.showLoading({title:"登录中..."}),n.login({provider:"weixin",success:function(n){var e=n.code;o.wxloginres(e)},fail:function(e){n.hideLoading(),n.showToast({icon:"none",title:"登录失败",duration:1500})}});case 3:case"end":return t.stop()}}),t)})))()},wxloginres:function(e){var t=this;return(0,u.default)(r.default.mark((function o(){var i;return r.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:i=t,(0,d.MPLogin)({code:e,appid:n.getAccountInfoSync().miniProgram.appId}).then((function(e){n.showToast({icon:"none",mask:!0,title:"登录成功",duration:1500}),i.$u.vuex("token",e.data.token),n.setStorageSync("token",e.data.token),i.isLogin=!0})).catch((function(n){})),n.hideLoading(),i.loginShow=!1;case 4:case"end":return o.stop()}}),o)})))()},connectSocket:function(){return(0,u.default)(r.default.mark((function e(){return r.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:n.connectSocket({url:s.default.ws});case 1:case"end":return e.stop()}}),e)})))()}}};e.default=h}).call(this,t("543d")["default"],t("bc2e")["default"])},"4a40":function(n,e,t){"use strict";t.r(e);var o=t("632f"),i=t("3c9b");for(var r in i)["default"].indexOf(r)<0&&function(n){t.d(e,n,(function(){return i[n]}))}(r);t("01af");var c=t("f0c5"),a=Object(c["a"])(i["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],void 0);e["default"]=a.exports},"50ff":function(n,e,t){"use strict";(function(n,e){var o=t("4ea4");t("3e5f");o(t("66fd"));var i=o(t("4a40"));n.__webpack_require_UNI_MP_PLUGIN__=t,e(i.default)}).call(this,t("bc2e")["default"],t("543d")["createPage"])},"632f":function(n,e,t){"use strict";t.d(e,"b",(function(){return i})),t.d(e,"c",(function(){return r})),t.d(e,"a",(function(){return o}));var o={uNoticeBar:function(){return Promise.all([t.e("common/vendor"),t.e("node-modules/uview-ui/components/u-notice-bar/u-notice-bar")]).then(t.bind(null,"bf27"))},zeroMarkdownView:function(){return t.e("uni_modules/zero-markdown-view/components/zero-markdown-view/zero-markdown-view").then(t.bind(null,"72af"))},uIcon:function(){return Promise.all([t.e("common/vendor"),t.e("node-modules/uview-ui/components/u-icon/u-icon")]).then(t.bind(null,"3bc5"))},uPopup:function(){return Promise.all([t.e("common/vendor"),t.e("node-modules/uview-ui/components/u-popup/u-popup")]).then(t.bind(null,"9027"))},uLine:function(){return Promise.all([t.e("common/vendor"),t.e("node-modules/uview-ui/components/u-line/u-line")]).then(t.bind(null,"3643"))},uButton:function(){return Promise.all([t.e("common/vendor"),t.e("node-modules/uview-ui/components/u-button/u-button")]).then(t.bind(null,"936f"))}},i=function(){var n=this,e=n.$createElement;n._self._c;n._isMounted||(n.e0=function(e){n.loginShow=!1},n.e1=function(e){n.signShow=!1})},r=[]},7553:function(n,e,t){}},[["50ff","common/runtime","common/vendor"]]]);